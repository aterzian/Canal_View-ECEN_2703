"""
Canal View utility functions.
"""

from typing import Optional, Sequence
import argparse

def parse_command(cmdline: Optional[str] = None) -> argparse.Namespace:
    """Extract command-line arguments."""
    npuzzles = 49
    parser = argparse.ArgumentParser(
        description='Solve Canal View puzzle.',
        formatter_class=argparse.ArgumentDefaultsHelpFormatter)
    parser.add_argument('-v', '--verbose', help='increase output verbosity',
                        default=0, action='count')
    parser.add_argument('-r', '--report', help='report CPU time and statistics',
                        default=False, action='store_true')
    parser.add_argument('-p', '--puzzle', help='puzzle to solve',
                        type=int, choices=range(npuzzles), default=0,
                        metavar=f'{{0..{npuzzles-1}}}')
    parser.add_argument('-s', '--solutions', help='maximum number of solutions',
                        type=int, default=None)
    parser.add_argument('-m', '--matplotlib', help='output matplotlib plot',
                        default=False, action='store_true')
    parser.add_argument('-a', '--annotate', help='draw spanning tree',
                        default=False, action='store_true')
    parser.add_argument('-f', '--fontsize', help='font size for matplotlib',
                        type=int, default=24)
    parser.add_argument('-d', '--drawonly', help='draw unsolved puzzle',
                        default=False, action='store_true')
    if cmdline is None:
        return parser.parse_args()
    else:
        return parser.parse_args(cmdline.split())

def get_grid(n: int) -> tuple[tuple[int,...],...]:
    """Return description of n-th puzzle."""

    X, _ = -1, -2
    A, B, C, D, E, F, G = 10, 11, 12, 13, 14, 15, 16

    if n == 0:
        return ((4,_,_,_,_,4),
                (_,_,_,_,_,_),
                (_,_,_,_,6,_),
                (_,4,_,_,_,_),
                (_,_,_,_,_,_),
                (6,_,_,_,_,6))
    elif n == 1:
        return ((_,6,_,_,_,6,_,_,_),
                (_,_,_,2,_,_,_,_,4),
                (_,_,_,_,_,_,_,_,_),
                (_,6,_,_,_,_,_,2,_),
                (_,_,_,_,_,_,_,_,_),
                (_,3,_,_,_,_,_,3,_),
                (_,_,_,_,_,_,_,_,_),
                (9,_,_,_,_,5,_,_,_),
                (_,_,_,3,_,_,_,3,_))
    elif n == 2:
        return ((3,_,_,_,_,3,_,_,_,_,3),
                (_,_,X,_,_,_,_,_,3,_,_),
                (_,5,_,_,_,_,_,_,_,5,_),
                (_,_,_,X,_,_,_,X,_,_,_),
                (_,_,_,_,1,_,1,_,_,_,_),
                (5,_,_,_,_,_,_,_,_,_,3),
                (_,_,_,_,1,_,1,_,_,_,_),
                (_,_,_,3,_,_,_,1,_,_,_),
                (_,3,_,_,_,_,_,_,_,5,_),
                (_,_,X,_,_,_,_,_,3,_,_),
                (X,_,_,_,_,1,_,_,_,_,5))
    elif n == 3:
        return ((_,4,_,_,2,_,2),
                (_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_),
                (_,3,_,1,_,3,_),
                (_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_),
                (X,_,1,_,_,4,_))
    elif n == 4:
        return ((_,_,_,_,_,_,_,3),
                (_,_,_,2,2,_,_,3),
                (_,_,_,_,_,_,_,_),
                (4,4,_,_,_,_,_,_),
                (_,_,_,_,_,_,3,3),
                (_,_,_,_,_,_,_,_),
                (1,_,_,1,1,_,_,_),
                (1,_,_,_,_,_,_,_))
    elif n == 5:
        return ((_,5,_,_,_,2,_,_),
                (_,_,_,_,_,_,6,_),
                (_,_,_,_,_,_,_,_),
                (_,3,_,_,4,_,_,3),
                (3,_,_,4,_,_,4,_),
                (_,_,_,_,_,_,_,_),
                (_,3,_,_,_,_,_,_),
                (_,_,5,_,_,_,3,_))
    elif n == 6:
        return ((_,_,8,_,_,_,_,_,1,_),
                (_,_,_,_,_,_,_,1,_,_),
                (_,_,_,_,_,4,_,_,_,_),
                (8,_,_,2,_,_,_,_,_,_),
                (_,_,_,_,_,4,_,_,_,_),
                (_,_,_,_,2,_,_,_,_,_),
                (_,_,_,_,_,_,2,_,_,4),
                (_,_,_,_,2,_,_,_,_,_),
                (_,_,4,_,_,_,_,_,_,_),
                (_,8,_,_,_,_,_,4,_,_))
    elif n == 7:
        return ((6,_,_,_,_,3,_,_,_,_,5),
                (_,_,_,_,_,_,_,_,_,_,_),
                (_,_,2,_,_,_,_,_,6,_,_),
                (_,_,_,_,_,4,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_,_),
                (2,_,_,6,_,_,_,9,_,_,1),
                (_,_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,5,_,_,_,_,_),
                (_,_,3,_,_,_,_,_,6,_,_),
                (_,_,_,_,_,_,_,_,_,_,_),
                (7,_,_,_,_,7,_,_,_,_,4))
    elif n == 8:
        return ((2,_,_,_,_,4,3,_,_,_,_,1),
                (_,_,_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,6,_,_,7,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_,_,_),
                (_,_,8,_,_,_,_,_,_,3,_,_),
                (1,_,_,_,_,4,3,_,_,_,_,4),
                (3,_,_,_,_,5,4,_,_,_,_,2),
                (_,_,7,_,_,_,_,_,_,3,_,_),
                (_,_,_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,4,_,_,4,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_,_,_),
                (3,_,_,_,_,6,2,_,_,_,_,3))
    elif n == 9:
        return ((1,_,_,1,_,_,_,0,_,_),
                (_,_,2,_,_,_,_,_,_,X),
                (_,_,_,_,X,_,_,_,_,_),
                (_,_,_,_,_,_,4,_,_,_),
                (_,8,_,7,_,6,_,_,5,_),
                (_,_,_,_,_,_,X,_,_,_),
                (_,_,_,_,3,_,_,_,_,_),
                (_,_,8,_,_,_,_,_,_,_),
                (6,_,_,_,_,_,_,4,_,_),
                (_,_,_,4,_,_,_,_,_,A))
    elif n == 10:
        return ((3,_,_,_,_,5,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,2,_,2,_,4,_),
                (_,_,2,_,_,_,_,_,_,_),
                (7,_,_,_,_,_,_,1,_,_),
                (_,_,2,_,_,_,_,_,_,4),
                (_,_,_,_,_,_,_,1,_,_),
                (_,2,_,1,_,1,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,6,_,_,_,_,7))
    elif n == 11:
        return ((_,_,4,_,_,1,3,_),
                (_,_,_,_,_,_,_,_),
                (_,_,_,_,3,_,_,1),
                (_,_,_,_,_,_,_,8),
                (_,7,_,_,_,_,_,_),
                (_,_,_,_,3,2,_,_),
                (_,_,4,_,_,_,2,_),
                (1,2,_,_,_,_,_,_))
    elif n == 12:
        return ((_,_,1,_,_,_,_,_,_),
                (3,_,_,_,9,_,_,_,_),
                (_,_,_,_,_,_,8,_,_),
                (_,_,_,_,_,4,_,3,_),
                (_,_,_,_,_,_,_,3,_),
                (_,4,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,3,7),
                (_,2,_,6,_,_,_,_,_),
                (_,_,_,4,_,_,_,_,_))
    elif n == 13:
        return ((_,_,_,_,_,7,_,4,_,_),
                (2,_,2,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,6,4,_,_),
                (_,_,3,_,_,_,_,_,_,_),
                (_,_,_,_,6,_,_,_,_,_),
                (_,_,_,_,_,_,5,_,2,3),
                (_,_,_,7,_,_,_,_,_,_),
                (_,_,_,_,_,_,5,_,_,_),
                (_,1,_,_,_,_,_,_,_,_),
                (5,_,_,_,3,_,_,_,_,1))
    elif n == 14:
        return ((1,_,3,_,1,_,_,_),
                (_,_,_,_,_,_,2,_),
                (_,_,_,_,5,1,_,_),
                (_,_,_,_,_,_,_,_),
                (_,5,_,_,_,_,2,_),
                (_,_,3,_,_,_,3,_),
                (_,_,_,_,_,_,_,_),
                (_,_,5,_,_,_,3,_))
    elif n == 15:
        return ((_,_,_,_,_,_,A,_,_),
                (_,2,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_),
                (_,8,_,_,_,_,_,4,3),
                (_,_,3,5,4,_,_,_,7),
                (_,_,_,_,_,_,B,_,_),
                (1,_,_,_,_,_,_,_,_),
                (_,_,4,_,_,_,_,_,_),
                (_,_,2,3,_,7,_,_,_))
    elif n == 16:
        return ((_,_,_,_,4,_,_),
                (3,_,5,1,_,_,_),
                (_,_,_,_,1,3,_),
                (_,7,_,_,_,_,_),
                (_,_,_,2,3,_,1),
                (_,_,_,_,_,_,_),
                (_,_,_,_,_,3,_))
    elif n == 17:
        return ((3,_,_,_,3,_),
                (_,2,_,_,_,_),
                (_,_,_,_,_,_),
                (_,_,_,_,_,_),
                (_,_,_,_,4,_),
                (_,5,_,_,_,2))
    elif n == 18:
        return ((_,_,7,_,_,_,_,_),
                (_,_,_,4,_,4,_,_),
                (0,_,_,_,X,_,_,_),
                (_,_,_,_,X,_,_,_),
                (_,_,_,_,_,_,8,_),
                (_,5,0,_,_,_,_,7),
                (_,_,_,_,1,_,_,_),
                (_,_,_,_,3,_,_,_))
    elif n == 19:
        return ((_,_,_,X,_,_,_,_,_,_,5),
                (_,3,_,_,_,_,4,4,3,_,_),
                (_,4,_,_,_,_,_,_,_,_,_),
                (_,7,_,X,5,_,_,_,_,_,2),
                (_,_,_,_,_,_,_,_,_,_,X),
                (_,_,_,_,_,D,_,_,_,_,_),
                (X,_,_,_,_,_,_,_,_,_,_),
                (X,_,_,_,_,_,4,1,_,3,_),
                (_,_,_,_,_,_,_,_,_,4,_),
                (_,_,4,0,1,_,_,_,_,1,_),
                (X,_,_,_,_,_,_,3,_,_,_))
    elif n == 20:
        return ((3,3,_,_,3,_),
                (_,_,_,_,_,_),
                (_,_,_,_,_,_),
                (_,_,3,_,_,_),
                (_,_,_,_,_,_),
                (3,_,_,_,_,3))
    elif n == 21:
        return ((_,_,_,_,_,_,_),
                (8,_,_,_,_,4,_),
                (_,_,_,4,_,_,_),
                (_,2,_,_,_,_,2),
                (_,_,_,_,_,_,_))
    elif n == 22:
        return ((_,_,_,2,_,_,_,_,4,_,_,_,_,3,_,_,_),
                (_,8,_,_,_,3,_,_,_,_,_,5,_,_,_,3,_),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,4),
                (7,_,_,_,_,_,2,_,_,4,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,5,_,_,_),
                (_,3,_,_,_,8,_,_,3,_,_,1,_,_,_,2,_),
                (_,_,_,2,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,3,_,_,1,_,_,_,_,_,8),
                (8,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,1,_,_,_,3,_,_,_,_,_,5,_,_,_,2,_),
                (_,_,_,2,_,_,_,_,2,_,_,_,_,5,_,_,_))
    elif n == 23:
        return ((0,_,0),
                (_,X,_),
                (0,_,0))
    elif n == 24:
        return ((1,0),
                (_,_))
    elif n == 25: # two solutions
        return ((4,_,_,_,_,4),
                (_,_,_,_,_,_),
                (_,_,_,_,4,_),
                (_,4,_,_,_,_),
                (_,_,_,_,_,_),
                (6,_,_,_,_,6))
    elif n == 26: # no solutions
        return ((4,_,_,_,_,4),
                (_,_,_,_,_,_),
                (_,_,_,_,7,_),
                (_,4,_,_,_,_),
                (_,_,_,_,_,_),
                (6,_,_,_,_,6))
    elif n == 27:
        return ((_,_,_,6,6,_,_,_,_,_),
                (_,_,_,_,_,_,1,1,_,_),
                (_,2,_,_,_,_,_,_,_,_),
                (_,2,_,_,_,_,_,_,_,5),
                (_,_,_,_,4,_,_,_,_,5),
                (5,_,_,_,_,4,_,_,_,_),
                (5,_,_,_,_,_,_,_,3,_),
                (_,_,_,_,_,_,_,_,3,_),
                (_,_,4,4,_,_,_,_,_,_),
                (_,_,_,_,_,5,5,_,_,_))
    elif n == 28:
        return ((2,_,_,_,1,_,_,_,_,_),
                (_,3,_,_,_,_,_,C,_,_),
                (_,_,4,_,_,_,_,_,X,_),
                (_,_,_,5,_,_,_,_,_,0),
                (_,_,_,_,6,_,_,_,_,_),
                (_,_,_,_,_,7,_,_,_,_),
                (_,_,_,_,_,_,8,_,_,_),
                (_,_,_,_,_,_,_,9,_,_),
                (_,B,_,_,_,_,_,_,A,_),
                (_,_,_,_,X,_,_,_,_,_))
    elif n == 29:
        return ((_,1,_,_,_,_,_,_,_,_),
                (_,_,1,_,_,_,_,_,_,2),
                (_,_,_,2,_,_,_,_,8,_),
                (_,_,_,_,2,_,_,2,_,_),
                (_,_,_,_,_,_,8,_,_,_),
                (_,_,_,2,_,_,_,_,_,_),
                (_,_,4,_,_,5,_,_,_,_),
                (_,2,_,_,_,_,5,_,_,_),
                (4,_,_,_,_,_,_,2,_,_),
                (_,_,_,_,_,_,_,_,2,_))
    elif n == 30:
        return ((_,_,_,_,4,5),
                (1,2,3,_,_,_),
                (_,_,_,_,_,_),
                (1,2,3,4,_,_),
                (_,_,_,_,_,_),
                (_,_,_,_,_,_))
    elif n == 31:
        return ((1,2,_,_,_,_,_,_,_,_),
                (_,_,3,4,_,_,7,_,_,_),
                (_,_,_,_,5,6,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (1,2,_,_,_,_,_,_,_,_),
                (_,_,3,4,_,_,7,_,1,2),
                (_,_,_,_,5,6,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (1,2,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,1,2))
    elif n == 32:
        return ((7,_,_,_,_,_,2),
                (_,2,_,_,_,_,_),
                (_,_,5,_,_,_,_),
                (_,_,_,4,_,_,2),
                (_,_,_,_,4,_,_),
                (_,_,_,_,_,_,_),
                (_,_,_,4,_,_,_))
    elif n == 33:
        return ((_,_,_,_,_,_,_,_,_,1),
                (1,_,_,_,_,A,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,E,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,C,_,_),
                (_,5,_,_,_,_,_,_,_,_),
                (_,_,_,_,C,_,_,_,_,3),
                (_,_,_,_,_,_,7,_,_,_),
                (_,_,5,_,_,_,_,_,3,_),
                (_,_,_,_,_,_,_,_,_,_))
    elif n == 34:
        return ((8,_,_,_,_,_,_,_,_,8),
                (_,_,_,_,_,_,_,_,3,_),
                (_,_,_,_,4,4,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,6,_,_,_,_,7,_,_),
                (_,_,6,_,_,_,_,7,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,7,7,_,_,_,_),
                (_,3,_,_,_,_,_,_,2,_),
                (8,_,_,_,_,_,_,_,_,X))
    elif n == 35:
        return ((_,_,_,_,A,_,_,_,_,_),
                (_,_,_,7,_,7,_,_,_,_),
                (_,_,_,_,_,_,A,_,_,_),
                (_,3,_,_,_,_,_,_,_,_),
                (A,_,_,_,_,_,_,_,7,_),
                (_,3,_,_,_,_,_,_,_,A),
                (_,_,X,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,7,_,_),
                (_,_,_,_,3,_,X,_,_,_),
                (_,_,_,_,_,A,_,_,_,_))
    elif n == 36:
        return ((_,_,_,_,_,_),
                (2,5,_,_,_,_),
                (_,_,_,_,_,_),
                (_,_,_,_,2,3),
                (1,2,_,_,_,_),
                (_,_,_,_,_,_))
    elif n == 37:
        return ((4,_,_,_,_,_,_,_,5,_),
                (_,_,_,_,_,6,_,_,_,_),
                (_,1,_,_,3,_,_,1,_,_),
                (_,_,_,_,_,_,5,_,_,_),
                (_,_,1,_,_,_,1,_,_,_),
                (4,_,_,_,_,_,_,_,_,_),
                (_,_,2,_,3,_,_,_,1,_),
                (_,_,_,_,_,_,_,_,_,_),
                (_,5,_,_,_,_,4,_,_,_),
                (_,_,_,1,_,_,_,_,3,_))
    elif n == 38:
        return ((_,_,_,_,_,_,_,_,_,_),
                (_,7,_,_,_,6,_,_,_,6),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,_,5,_,_,_,6,_,_),
                (_,_,8,_,_,_,_,_,_,_),
                (_,_,_,_,_,4,_,_,_,2),
                (_,G,_,_,_,_,_,_,_,_),
                (_,_,_,_,A,_,_,4,_,_),
                (6,_,_,6,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,2))
    elif n == 39:
        return ((_,_,4,_,_,3,2,_,_,_),
                (_,_,3,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (1,4,_,_,_,_,_,2,4,_),
                (_,_,_,_,5,5,_,_,_,_),
                (_,_,_,_,5,5,_,_,_,_),
                (_,2,1,_,_,_,_,_,7,4),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,3,_,_),
                (_,_,_,4,2,_,_,1,_,_))
    elif n == 40:
        return ((_,4,_,_,3,1,_,_,_,X),
                (A,_,_,_,_,_,_,_,_,_),
                (_,_,_,3,_,_,_,_,5,_),
                (_,_,_,_,_,_,_,_,_,_),
                (_,X,_,_,_,_,3,_,_,_),
                (1,6,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,6,2,5),
                (_,_,4,_,_,_,_,_,_,_),
                (X,_,_,1,_,_,_,_,_,2),
                (_,_,_,_,_,_,_,_,A,_))
    elif n == 41:
        return ((_,1,_,_,_,1,_,_,_,_),
                (_,_,_,1,_,_,_,1,_,_),
                (_,_,_,_,_,_,_,_,_,1),
                (_,1,1,_,1,_,_,_,_,_),
                (_,_,_,1,_,_,_,_,1,_),
                (1,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,1,_,_,_),
                (_,1,_,1,_,_,_,1,_,1),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,1,_,1,_,_,1,_,_))
    elif n == 42:
        return ((_,_,_,_,_,_,8,_),
                (_,_,1,_,_,_,_,_),
                (_,1,_,5,_,_,_,_),
                (_,_,2,_,_,_,_,_),
                (_,1,_,6,_,_,_,_),
                (_,_,3,_,_,_,_,_),
                (_,_,_,7,_,_,_,4),
                (_,_,4,_,_,_,_,_))
    elif n == 43:
        return ((_,_,2,_,_,_,_,_,4),
                (_,_,_,_,_,_,_,_,_),
                (_,_,_,_,5,0,_,_,5),
                (_,4,_,4,_,_,5,_,_),
                (_,5,_,_,2,_,_,6,_),
                (_,_,4,_,_,3,_,4,_),
                (1,_,_,0,6,_,_,_,_),
                (_,_,_,_,_,_,_,_,_),
                (0,_,_,_,_,_,0,_,_))
    elif n == 44:
        return ((_,_,_,_,3,_,_,_,_,_),
                (_,1,2,_,_,_,_,3,2,_),
                (_,4,3,_,_,_,_,4,1,_),
                (_,_,_,_,6,5,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,2,2,_,_,_,_),
                (_,1,3,_,_,_,_,1,3,_),
                (_,2,4,_,_,_,_,4,2,_),
                (_,_,_,_,_,3,_,_,_,_))
    elif n == 45:
        return ((_,_,2,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,2,_),
                (_,_,_,_,_,_,_,_,_,_),
                (1,_,_,_,2,_,_,_,6,_),
                (_,_,_,_,_,_,1,_,_,_),
                (_,_,_,9,_,_,_,_,_,_),
                (_,3,_,_,_,8,_,_,_,3),
                (_,_,_,_,_,_,_,_,_,_),
                (_,7,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,8,_,_))
    elif n == 46:
        return ((_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,_,4,_,6,_,_,_,1,_,4,_,_,_,6,_,_,_,4,_,_,_,6,_,2,_,_,_,9,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,7,_,_,_,_,_,2,_,_,_,2,_,_,4,2,_,_,1,_,_,2,_,_,_,3,_,_,9,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,6,_,_,_,_,_,1,_,1,_,1,_,_,2,_,_,1,4,_,_,4,_,2,_,2,_,_,9,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,_,8,_,6,_,_,5,_,_,_,2,_,_,5,_,_,_,2,_,_,2,_,_,_,3,_,_,3,_,8,_,A,_),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_))
    elif n == 47:
        return ((3,_,_,_,_,8,_,_,_,_,1,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,8,_,_,_,_,_,_),
                (_,_,2,_,_,_,1,_,_,_,_,7,_,_,_),
                (_,_,_,_,1,_,_,_,_,_,_,_,_,_,_),
                (8,_,_,_,_,_,_,_,1,_,_,_,9,_,_),
                (_,_,_,_,1,_,_,_,_,_,_,_,_,_,_),
                (B,_,_,_,_,_,_,B,_,_,_,_,_,_,7),
                (_,_,_,_,_,_,_,_,_,_,1,_,_,_,_),
                (_,_,B,_,_,_,1,_,_,_,_,_,_,_,5),
                (_,_,_,_,_,_,_,_,_,_,1,_,_,_,_),
                (_,_,_,2,_,_,_,_,1,_,_,_,4,_,_),
                (_,_,_,_,_,_,7,_,_,_,_,_,_,_,_),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,_,_,_,8,_,_,_,_,A,_,_,_,_,2))
    elif n == 48:
        return ((0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0),
                (_,_,0,_,_,_,_,0,_,_,_,_,0,_,_,_,_,0,_,_,_,_,0,_,_,_,_,0,_,_),
                (_,0,8,_,_,_,_,9,_,_,_,_,9,_,_,_,_,9,_,_,_,_,9,_,_,_,_,8,0,_),
                (_,_,_,2,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (0,_,_,_,0,0,_,1,_,0,0,_,1,_,0,0,_,1,_,0,0,_,1,_,0,0,_,_,_,0),
                (0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0),
                (_,_,_,_,_,_,_,0,_,_,_,_,0,_,_,_,_,0,_,_,_,_,0,_,_,_,_,_,_,_),
                (_,0,9,_,_,_,_,9,_,_,_,_,9,_,_,_,_,9,_,_,_,_,9,_,_,_,_,9,0,_),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (0,_,_,_,0,0,_,_,_,0,0,_,1,_,0,0,_,1,_,0,0,_,_,_,0,0,_,_,_,0),
                (0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0),
                (_,_,_,_,_,_,_,_,_,_,_,_,0,_,_,_,_,0,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,0,9,_,_,_,_,9,_,_,_,_,9,_,_,_,_,9,_,_,_,_,9,_,_,_,_,9,0,_),
                (_,_,_,_,_,_,_,0,_,_,_,_,_,_,_,_,_,_,_,_,_,_,0,_,_,_,_,_,_,_),
                (0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0),
                (0,_,_,_,0,0,_,1,_,0,0,_,_,_,0,0,_,_,_,0,0,_,1,_,0,0,_,_,_,0),
                (_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_),
                (_,0,8,_,_,_,_,9,_,_,_,_,9,_,1,1,_,9,_,_,_,_,9,_,_,_,_,8,0,_),
                (_,_,0,_,_,_,_,0,_,_,_,_,0,_,_,_,_,0,_,_,_,_,0,_,_,_,_,0,_,_),
                (0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,_,_,_,0))

    else:
        raise ValueError('index out of bound')

def check_grid(grid: Sequence[Sequence[int]]) -> None:
    """Perform sanity check on input grid."""
    nrow = len(grid)
    if nrow == 0:
        raise RuntimeError('Empty grid!')
    ncol = len(grid[0])
    for row in grid:
        if len(row) != ncol:
            raise RuntimeError('Non-rectangular grid!')
        for c in row:
            if c < -2 or c > nrow + ncol - 1:
                raise RuntimeError(f'Invalid clue ({c})!')

if __name__ == '__main__':

    args = parse_command()

    try:
        grid = get_grid(args.puzzle)
        check_grid(grid)
    except Exception as err:
        raise SystemExit(err)
